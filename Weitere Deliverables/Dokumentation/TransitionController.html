<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: TransitionController
  
    &mdash; Documentation by YARD 0.9.27
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "TransitionController";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (T)</a> &raquo;
    
    
    <span class="title">TransitionController</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: TransitionController
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActionController::Base</li>
          
            <li class="next"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></li>
          
            <li class="next">TransitionController</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/controllers/transition_controller.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Handles all communication between the Frontend and the Transition table in the DB. There are also some methods that create or update Differences.</p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#approveUpload-instance_method" title="#approveUpload (instance method)">#<strong>approveUpload</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>method to check if the user-provided transition and the possibly added catalog fulfill all the db requirements to be uploaded.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create-instance_method" title="#create (instance method)">#<strong>create</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Creates a new transition and adds all differences.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#index-instance_method" title="#index (instance method)">#<strong>index</strong>  &#x21d2; json </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Lists all available transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#show-instance_method" title="#show (instance method)">#<strong>show</strong>  &#x21d2; json </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Lists differences between two consecutive years.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_difference-instance_method" title="#update_difference (instance method)">#<strong>update_difference</strong>  &#x21d2; json </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Updates a specific difference with a new checked and comment.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="approveUpload-instance_method">
  
    #<strong>approveUpload</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>method to check if the user-provided transition and the possibly added catalog fulfill all the db requirements to be uploaded</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>transition</span>
      
      
        <span class='type'>(<tt>File</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>transition file uploaded by user</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>year</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the year of the catalog manually input by the user, can be the empty string if no catalog is uploaded</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>catalog</span>
      
      
        <span class='type'>(<tt>File</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>catalog file uploaded by the user, can possibly be empty if no catalog is uploaded</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>returns headers depicting different cases: ok (200) -&gt;                     all useruploaded parameters are okay and the transition can be uploaded to the DB, not_acceptable (406) -&gt;         the DB already contains a transition for the requested year, bad_request (400) -&gt;            the old year catalog needed to upload the transition does not exist in the DB, conflict (409) -&gt;               the new year catalog needed to upload the transition has not been uploaded nor exists in the DB, precondition_failed (412) -&gt;    the catalog parameter which has been uploaded does not match the expected new year of the transition</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/transition_controller.rb', line 24</span>

<span class='kw'>def</span> <span class='id identifier rubyid_approveUpload'>approveUpload</span>
    <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>roo</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_xlsx'>xlsx</span> <span class='op'>=</span> <span class='const'>Roo</span><span class='op'>::</span><span class='const'>Spreadsheet</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:transition</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_sheet1'>sheet1</span> <span class='op'>=</span> <span class='id identifier rubyid_xlsx'>xlsx</span><span class='period'>.</span><span class='id identifier rubyid_sheet'>sheet</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
    <span class='comment'># precondition, the yearversion is in second column
</span>    <span class='id identifier rubyid_year_old'>year_old</span> <span class='op'>=</span> <span class='id identifier rubyid_sheet1'>sheet1</span><span class='period'>.</span><span class='id identifier rubyid_cell'>cell</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>B</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span><span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
    <span class='id identifier rubyid_year_new'>year_new</span> <span class='op'>=</span> <span class='id identifier rubyid_year_old'>year_old</span> <span class='op'>+</span> <span class='int'>1</span><span class='semicolon'>;</span>

    <span class='id identifier rubyid_catalogYear'>catalogYear</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:year</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>

    <span class='kw'>if</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Transition.html" title="Transition (class)">Transition</a></span></span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_year_old'>year_old</span><span class='embexpr_end'>}</span><span class='tstring_content'>-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_year_new'>year_new</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='comment'># transition already exists in DB
</span>        <span class='id identifier rubyid_head'>head</span> <span class='symbol'>:not_acceptable</span>
    <span class='kw'>elsif</span><span class='lparen'>(</span><span class='op'>!</span><span class='const'><span class='object_link'><a href="Catalog.html" title="Catalog (class)">Catalog</a></span></span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='label'>year:</span> <span class='id identifier rubyid_year_old'>year_old</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='comment'># old year catalog doesn&#39;t exist in backend
</span>        <span class='id identifier rubyid_head'>head</span> <span class='symbol'>:bad_request</span>
    <span class='kw'>elsif</span><span class='lparen'>(</span><span class='op'>!</span><span class='const'><span class='object_link'><a href="Catalog.html" title="Catalog (class)">Catalog</a></span></span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='label'>year:</span> <span class='id identifier rubyid_year_new'>year_new</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:catalog</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='comment'># new year catalog has not been uploaded nor was found in DB
</span>        <span class='id identifier rubyid_head'>head</span> <span class='symbol'>:conflict</span>
    <span class='kw'>elsif</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:catalog</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_catalogYear'>catalogYear</span> <span class='op'>!=</span> <span class='lparen'>(</span><span class='id identifier rubyid_year_new'>year_new</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='comment'># uploaded catalog is not the year it should be
</span>        <span class='id identifier rubyid_head'>head</span> <span class='symbol'>:precondition_failed</span>
    <span class='kw'>else</span> 
        <span class='id identifier rubyid_head'>head</span> <span class='symbol'>:ok</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create-instance_method">
  
    #<strong>create</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Creates a new transition and adds all differences</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>transition</span>
      
      
        <span class='type'>(<tt>xlsx file</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>transitionfile in xlsx format. Only first sheet is evaluated. Has to contain the old year in the B2 cell.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>status 200 if successful</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/transition_controller.rb', line 91</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>
    <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>roo</span><span class='tstring_end'>&#39;</span></span>

    <span class='comment'># precondition: both old and new catalog already exist in database
</span>
    <span class='id identifier rubyid_xlsx'>xlsx</span> <span class='op'>=</span> <span class='const'>Roo</span><span class='op'>::</span><span class='const'>Spreadsheet</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:transition</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='comment'># puts xlsx.info
</span>
    <span class='id identifier rubyid_sheet1'>sheet1</span> <span class='op'>=</span> <span class='id identifier rubyid_xlsx'>xlsx</span><span class='period'>.</span><span class='id identifier rubyid_sheet'>sheet</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>

    <span class='comment'># precondition, the yearversion is in second column
</span>    <span class='id identifier rubyid_year_old'>year_old</span> <span class='op'>=</span> <span class='id identifier rubyid_sheet1'>sheet1</span><span class='period'>.</span><span class='id identifier rubyid_cell'>cell</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>B</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span><span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
    <span class='id identifier rubyid_year_new'>year_new</span> <span class='op'>=</span> <span class='id identifier rubyid_year_old'>year_old</span> <span class='op'>+</span> <span class='int'>1</span><span class='semicolon'>;</span>

    <span class='id identifier rubyid_catalog_old'>catalog_old</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Catalog.html" title="Catalog (class)">Catalog</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>year:</span> <span class='id identifier rubyid_year_old'>year_old</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span> <span class='comment'># .to_i converts string to integer
</span>    <span class='id identifier rubyid_catalog_new'>catalog_new</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Catalog.html" title="Catalog (class)">Catalog</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>year:</span> <span class='id identifier rubyid_year_new'>year_new</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span>
    
    <span class='id identifier rubyid_transition'>transition</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Transition.html" title="Transition (class)">Transition</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_year_old'>year_old</span><span class='embexpr_end'>}</span><span class='tstring_content'>-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_year_new'>year_new</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
        <span class='label'>catalog_id_old:</span> <span class='id identifier rubyid_catalog_old'>catalog_old</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
        <span class='label'>catalog_id_new:</span> <span class='id identifier rubyid_catalog_new'>catalog_new</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='semicolon'>;</span>
        
    <span class='id identifier rubyid_transition'>transition</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
    
    
    
    <span class='id identifier rubyid_bulk'>bulk</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_sheet1'>sheet1</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='label'>category:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Kategorie</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>chop_code_old:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Chop Code N-1</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>chop_title_old:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Chop Titel N-1</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>chop_code_new:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Chop Code N</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>chop_title_new:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Chop Titel N</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hash'>hash</span><span class='op'>|</span>
        <span class='comment'># hash is of type hash datastructure. Handles different than e.g. JSON
</span>        
        <span class='id identifier rubyid_difference'>difference</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
        <span class='id identifier rubyid_difference'>difference</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>transition_id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_transition'>transition</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
        <span class='id identifier rubyid_difference'>difference</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>chop_id_old</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>nil</span>
        <span class='id identifier rubyid_difference'>difference</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>chop_id_new</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>nil</span>

        <span class='id identifier rubyid_old_complement'>old_complement</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='comment'># instantiate complement so we can reference it later
</span>        <span class='id identifier rubyid_new_complement'>new_complement</span> <span class='op'>=</span> <span class='kw'>nil</span>

        <span class='comment'># accessing every chop code via it&#39;s chop_code is rather slow, maybe needs improvement
</span>        <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='symbol'>:chop_code_old</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UNDEF</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
            <span class='id identifier rubyid_chop_old'>chop_old</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Chop.html" title="Chop (class)">Chop</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>code:</span> <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='symbol'>:chop_code_old</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>catalog_id:</span> <span class='id identifier rubyid_catalog_old'>catalog_old</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
            <span class='kw'>unless</span> <span class='id identifier rubyid_chop_old'>chop_old</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_difference'>difference</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>chop_id_old</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_chop_old'>chop_old</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
                <span class='id identifier rubyid_old_complement'>old_complement</span> <span class='op'>=</span> <span class='id identifier rubyid_chop_old'>chop_old</span><span class='period'>.</span><span class='id identifier rubyid_complement'>complement</span>
            <span class='kw'>end</span>
            
        <span class='kw'>end</span>
        <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='symbol'>:chop_code_new</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UNDEF</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
            <span class='id identifier rubyid_chop_new'>chop_new</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Chop.html" title="Chop (class)">Chop</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>code:</span> <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='symbol'>:chop_code_new</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>catalog_id:</span> <span class='id identifier rubyid_catalog_new'>catalog_new</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
            <span class='kw'>unless</span> <span class='id identifier rubyid_chop_new'>chop_new</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_difference'>difference</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>chop_id_new</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_chop_new'>chop_new</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
                <span class='id identifier rubyid_new_complement'>new_complement</span> <span class='op'>=</span> <span class='id identifier rubyid_chop_new'>chop_new</span><span class='period'>.</span><span class='id identifier rubyid_complement'>complement</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>
        <span class='comment'># only insert into db if it is actual difference
</span>        <span class='comment'># find out if code, text or codable has changed
</span>        <span class='kw'>unless</span> <span class='id identifier rubyid_difference'>difference</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>chop_id_old</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_difference'>difference</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>chop_id_new</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
            <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='symbol'>:chop_code_old</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='symbol'>:chop_code_new</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='symbol'>:chop_title_old</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='symbol'>:chop_title_new</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_old_complement'>old_complement</span> <span class='op'>!=</span> <span class='id identifier rubyid_new_complement'>new_complement</span><span class='rparen'>)</span>
                <span class='comment'># mapping_type to enum translation
</span>                <span class='kw'>case</span> <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='symbol'>:category</span><span class='rbracket'>]</span>
                <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1:1 - Überleitung: gleiche Codes</span><span class='tstring_end'>&quot;</span></span>
                    <span class='id identifier rubyid_difference'>difference</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mapping_type</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>0</span>
                <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1:1 - Überleitung: verschiedene Codes</span><span class='tstring_end'>&quot;</span></span>
                    <span class='id identifier rubyid_difference'>difference</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mapping_type</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>1</span>
                <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Titelerweiterung</span><span class='tstring_end'>&quot;</span></span>
                    <span class='id identifier rubyid_difference'>difference</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mapping_type</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>2</span>
                <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Aufgliederung</span><span class='tstring_end'>&quot;</span></span>
                    <span class='id identifier rubyid_difference'>difference</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mapping_type</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>3</span>
                <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Kondensation</span><span class='tstring_end'>&quot;</span></span>
                    <span class='id identifier rubyid_difference'>difference</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mapping_type</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>4</span>
                <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Kreation</span><span class='tstring_end'>&quot;</span></span>
                    <span class='id identifier rubyid_difference'>difference</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mapping_type</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>5</span>
                <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Andere</span><span class='tstring_end'>&quot;</span></span>
                    <span class='id identifier rubyid_difference'>difference</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mapping_type</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>6</span>
                <span class='kw'>else</span>
                    <span class='id identifier rubyid_difference'>difference</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mapping_type</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>7</span> <span class='comment'># map to unknown
</span>                <span class='kw'>end</span>
                <span class='id identifier rubyid_difference'>difference</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>checked</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>yellow</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='comment'>#set status/checked to yellow at the beginning
</span>                <span class='id identifier rubyid_difference'>difference</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>comment</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='comment'>#initialize to empty string
</span>                <span class='id identifier rubyid_bulk'>bulk</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_difference'>difference</span><span class='rparen'>)</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='const'><span class='object_link'><a href="Difference.html" title="Difference (class)">Difference</a></span></span><span class='period'>.</span><span class='id identifier rubyid_insert_all'>insert_all</span><span class='lparen'>(</span><span class='id identifier rubyid_bulk'>bulk</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_head'>head</span> <span class='symbol'>:created</span>    

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="index-instance_method">
  
    #<strong>index</strong>  &#x21d2; <tt>json</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Lists all available transitions</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>json</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>all available transitions as json</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


7
8
9
10</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/transition_controller.rb', line 7</span>

<span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
    <span class='ivar'>@transitions</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Transition.html" title="Transition (class)">Transition</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_render'>render</span> <span class='symbol'>:json</span> <span class='op'>=&gt;</span> <span class='ivar'>@transitions</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="show-instance_method">
  
    #<strong>show</strong>  &#x21d2; <tt>json</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Lists differences between two consecutive years</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the name of the transition that should be returned. Transitions are named by the old year minus the  new year , e.g. &#39;2021-2022&#39;</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>json</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>all Differences between the two specified years in a json format</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


52
53
54
55
56
57
58
59
60
61</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/transition_controller.rb', line 52</span>

<span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
    <span class='kw'>if</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Transition.html" title="Transition (class)">Transition</a></span></span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='symbol'>:name</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='ivar'>@transition</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Transition.html" title="Transition (class)">Transition</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='symbol'>:name</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='ivar'>@differences</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Difference.html" title="Difference (class)">Difference</a></span></span><span class='period'>.</span><span class='id identifier rubyid_includes'>includes</span><span class='lparen'>(</span><span class='symbol'>:chop_new</span><span class='comma'>,</span> <span class='symbol'>:chop_old</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:transition_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@transition</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_render'>render</span> <span class='symbol'>:json</span> <span class='op'>=&gt;</span> <span class='ivar'>@differences</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span><span class='lparen'>(</span><span class='symbol'>:include</span> <span class='op'>=&gt;</span><span class='lbracket'>[</span><span class='symbol'>:chop_new</span><span class='comma'>,</span> <span class='symbol'>:chop_old</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
        <span class='id identifier rubyid_head'>head</span> <span class='int'>404</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_difference-instance_method">
  
    #<strong>update_difference</strong>  &#x21d2; <tt>json</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Updates a specific difference with a new checked and comment</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>number</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the id of the difference that should be updated</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>checked</span>
      
      
        <span class='type'>(<tt>string</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the new checked of this difference. Can be &#39;red&#39;, &#39;yellow&#39; or &#39;green&#39;</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>comment</span>
      
      
        <span class='type'>(<tt>string</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the new comment of this difference.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>json</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the new difference as json</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/transition_controller.rb', line 69</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_difference'>update_difference</span>
    <span class='ivar'>@difference</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Difference.html" title="Difference (class)">Difference</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:checked</span><span class='rbracket'>]</span>
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>red</span><span class='tstring_end'>&quot;</span></span>
        <span class='ivar'>@difference</span><span class='period'>.</span><span class='id identifier rubyid_red!'>red!</span>
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>yellow</span><span class='tstring_end'>&quot;</span></span>
        <span class='ivar'>@difference</span><span class='period'>.</span><span class='id identifier rubyid_yellow!'>yellow!</span>
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>green</span><span class='tstring_end'>&quot;</span></span>
        <span class='ivar'>@difference</span><span class='period'>.</span><span class='id identifier rubyid_green!'>green!</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='lparen'>(</span> <span class='ivar'>@difference</span><span class='period'>.</span><span class='id identifier rubyid_update_column'>update_column</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>comment</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:comment</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_render'>render</span> <span class='symbol'>:json</span> <span class='op'>=&gt;</span> <span class='ivar'>@difference</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span><span class='lparen'>(</span><span class='symbol'>:include</span> <span class='op'>=&gt;</span><span class='lbracket'>[</span><span class='symbol'>:chop_new</span><span class='comma'>,</span> <span class='symbol'>:chop_old</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
        <span class='id identifier rubyid_head'>head</span> <span class='symbol'>:bad_request</span>
    <span class='kw'>end</span>       
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sun May 22 18:37:30 2022 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.27 (ruby-3.0.2).
</div>

    </div>
  </body>
</html>